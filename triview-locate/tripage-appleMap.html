<script src="https://cdn.apple-mapkit.com/mk/5.x.x/mapkit.js"></script>

<dom-module id="tripage-appleMap" assetpath="">
	<template>
		<style include="shared-locate-app-styles shared-graphic-styles">

			#map {
        		height: 100%;
        		width:	100%;
        		margin: 5px;
      		}
		</style>
	    <!--<div>
	    	<p>{{myTitle}}</p>
	    </div>--> 
	    <div id="map"></div>
	</template>
	<script>
		Polymer({

			is: "tripage-appleMap",

			behaviors: [
				TriBlockViewResponsiveBehavior,
				Polymer.IronResizableBehavior
			],

			//this function fires when the polymer object is loaded
			ready: function () {
				console.log("Entering ready()...");
				this.myTitle = "Hello World! --- This is Apple(2).";
				
				console.log("Defining Apple Map Annotations...");
		    	var MarkerAnnotation = mapkit.MarkerAnnotation,
                    clickAnnotation;
                var sfo = new mapkit.Coordinate(37.616934, -122.383790),
                    work = new mapkit.Coordinate(37.3349, -122.0090201);

                console.log("Initializing Apple Map...");
                mapkit.init({
                    authorizationCallback: function(done) {
                        var xhr = new XMLHttpRequest();
                        xhr.open("GET", "/jwtoken");
                        xhr.addEventListener("load", function() {
                            //done(this.responseText);
                            done("eyJhbGciOiJFUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6IjdGWTNOMzhOUUcifQ.eyJpc3MiOiJRN1c0N0dGS0wzIiwiaWF0IjoxNTcyNjE1Mjk4LjM1MzMzMSwiZXhwIjoxNTc1MjA3Mjk4LjM1MzMzMX0.GyBlhiv0Eic8k9jnDJYL7ysFK49ZSGlM0XeNCG7rmTDj_vQqTIB3mC2iW9rGi0Ks0I_gXU2qiC_zN4mRWfoWQw");
                        });
                        xhr.send();
                    }
                });

                /*var currentLocation = new mapkit.CoordinateRegion(
                	new mapkit.Coordinate(47.658779, -117.426048),
            		new mapkit.CoordinateSpan(0.167647972, 0.354985255)
        		);*/

                console.log("Setting Apple Map Properties...");
                /*var map = new mapkit.Map("map");

                map.showsUserLocation = true;
                map.isUserLocationVisible = true;*/

                var map = new mapkit.Map("map", {
                	isUserLocationVisible: true,
        			showsPointsOfInterest: true,
        			showsMapTypeControl: true,
        			showsUserLocation: true,
        			showsZoomControl: true
    			});

                // Setting properties on creation:
                var sfoAnnotation = new MarkerAnnotation(sfo, { color: "#f4a56d", title: "SFO", glyphText: "✈️" });

                // Setting properties after creation:
                var workAnnotation = new MarkerAnnotation(work);
                workAnnotation.color = "#969696";
                workAnnotation.title = "Work";
                workAnnotation.subtitle = "Apple Park";
                workAnnotation.selected = "true";
                workAnnotation.glyphText = "";

                console.log("Display Apple Map Annotations...");
                // Add and show both annotations on the map
                map.showItems([sfoAnnotation, workAnnotation]);
				
				// Drop an annotation where a Shift-click is detected:
                map.element.addEventListener("click", function(event) {
                    if(!event.shiftKey) {
                        return;
                    }

                    if(clickAnnotation) {
                        map.removeAnnotation(clickAnnotation);
                    }

                    var coordinate = map.convertPointOnPageToCoordinate(new DOMPoint(event.pageX, event.pageY));
                        clickAnnotation = new MarkerAnnotation(coordinate, {
                            title: "Click!",
                            color: "#c969e0"
                        });
                    map.addAnnotation(clickAnnotation);
                });

				console.log("Exiting ready()...");
			} //end of ready()

		});
	</script>
</dom-module>